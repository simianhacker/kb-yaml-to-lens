---
dashboards:
  - name: '[ES|QL] Controls Example'
    description: Example dashboard demonstrating ES|QL controls with static and query-driven values
    settings:
      controls:
        chain_controls: true
        label_position: inline
    controls:
      # Static values ES|QL control
      - type: esql
        variable_name: service_environment
        variable_type: values
        choices:
          - production
          - staging
          - development
        label: Service Environment
        width: medium
        multiple: false

      # Query-driven ES|QL control
      - type: esql
        variable_name: status_code
        variable_type: values
        query: FROM logs-* | STATS count = COUNT(*) BY http.response.status_code | KEEP http.response.status_code | LIMIT 20
        label: HTTP Status Code
        width: medium
        multiple: true

      # Another query-driven control using the first variable
      - type: esql
        variable_name: host
        variable_type: values
        query: FROM logs-* | WHERE service.environment == ?service_environment | STATS count = COUNT(*) BY host.name | KEEP host.name | LIMIT
          20
        label: Host Name
        width: large
    panels:
      # ES|QL Metric using variables
      - title: Total Requests
        description: Total number of requests filtered by environment and status code
        grid: {x: 0, y: 0, w: 12, h: 8}
        esql:
          type: metric
          primary:
            field: total_requests
            id: metric_total_requests
          query:
            - FROM logs-*
            - WHERE service.environment == ?service_environment
            - WHERE http.response.status_code IN (?status_code)
            - STATS total_requests = COUNT(*)

      # ES|QL Pie chart showing status code distribution
      - title: Status Code Distribution
        description: Distribution of HTTP status codes
        grid: {x: 12, y: 0, w: 12, h: 8}
        esql:
          type: pie
          slice_by:
            - field: http.response.status_code
              id: dim_status_code
          metrics:
            - field: count
              id: metric_count
          query:
            - FROM logs-*
            - WHERE service.environment == ?service_environment
            - WHERE http.response.status_code IN (?status_code)
            - STATS count = COUNT(*) BY http.response.status_code

      # ES|QL Table showing filtered data
      - title: Request Details
        description: Detailed request log filtered by controls
        grid: {x: 24, y: 0, w: 24, h: 8}
        esql:
          type: datatable
          query:
            - FROM logs-*
            - WHERE service.environment == ?service_environment
            - WHERE http.response.status_code IN (?status_code)
            - WHERE host.name == ?host
            - KEEP @timestamp, host.name, http.response.status_code, url.path
            - LIMIT 100
