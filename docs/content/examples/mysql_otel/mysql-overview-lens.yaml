---
# MySQL OpenTelemetry Overview Dashboard (Lens Version)
# Comprehensive MySQL metrics dashboard using OpenTelemetry MySQL receiver
#
# Metrics reference: https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/mysqlreceiver
dashboards:
  - id: mysql-otel-overview-lens
    name: '[Metrics MySQL] Overview (Lens)'
    description: Comprehensive MySQL metrics dashboard using OpenTelemetry MySQL receiver (Lens version)
    controls:
      - type: options
        label: MySQL Host
        data_view: metrics-*
        field: resource.attributes.host.name
      - type: options
        label: MySQL Instance
        data_view: metrics-*
        field: resource.attributes.service.instance.id
    filters:
      - field: data_stream.dataset
        equals: mysqlreceiver.otel
    panels:
      # Navigation Links
      - title: Navigation Links
        size: {w: 48, h: 2}
        position: {x: 0, y: 0}
        links:
          layout: horizontal
          items:
            - label: MySQL Overview (Lens)
              dashboard: mysql-otel-overview-lens
            - label: MySQL Overview (ES|QL)
              dashboard: mysql-otel-overview-esql

      # Overview Metrics Row (y=2, h=6)
      - title: Active Connections
        size: {w: 12, h: 6}
        position: {x: 0, y: 2}
        lens:
          type: metric
          data_view: metrics-*
          primary:
            field: mysql.threads
            aggregation: max
            label: Active Connections
          filters:
            - field: threads
              equals: connected
      - title: Buffer Pool Efficiency
        size: {w: 12, h: 6}
        position: {x: 12, y: 2}
        description: Ratio of clean to total buffer pool pages
        lens:
          type: metric
          data_view: metrics-*
          primary:
            formula: "max(mysql.buffer_pool.usage, kql='buffer_pool_data: \"clean\"') / (max(mysql.buffer_pool.usage, kql='buffer_pool_data: \"\
              clean\"') + max(mysql.buffer_pool.usage, kql='buffer_pool_data: \"dirty\"'))"
            label: Buffer Pool Efficiency
            format:
              type: percent
      - title: InnoDB Operations Rate
        size: {w: 12, h: 6}
        position: {x: 24, y: 2}
        lens:
          type: metric
          data_view: metrics-*
          primary:
            formula: counter_rate(max(mysql.operations))
            label: InnoDB Ops/sec
      - title: Handler Operations Rate
        size: {w: 12, h: 6}
        position: {x: 36, y: 2}
        lens:
          type: metric
          data_view: metrics-*
          primary:
            formula: counter_rate(max(mysql.handlers))
            label: Handler Ops/sec

      # Buffer Pool Performance Section (y=8)
      - title: Buffer Pool Usage Over Time
        size: {w: 24, h: 9}
        position: {x: 0, y: 8}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: buffer_pool_data
            type: values
            size: 10
          metrics:
            - field: mysql.buffer_pool.usage
              aggregation: max
              label: Buffer Pool Usage
              format:
                type: bytes
      - title: Buffer Pool Pages
        size: {w: 24, h: 9}
        position: {x: 24, y: 8}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: buffer_pool_pages
            type: values
            size: 10
          metrics:
            - field: mysql.buffer_pool.pages
              aggregation: max
              label: Buffer Pool Pages
      - title: Buffer Pool Operations
        size: {w: 24, h: 9}
        position: {x: 0, y: 17}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: buffer_pool_operations
            type: values
            size: 10
          metrics:
            - formula: counter_rate(max(mysql.buffer_pool.operations))
              label: Operations/sec
      - title: Buffer Pool Page Flushes
        size: {w: 24, h: 9}
        position: {x: 24, y: 17}
        lens:
          type: line
          data_view: metrics-*
          dimension:
            field: '@timestamp'
            type: date_histogram
          metrics:
            - formula: counter_rate(max(mysql.buffer_pool.page_flushes))
              label: Page Flushes/sec

      # InnoDB Operations Section (y=26)
      - title: Row Operations
        size: {w: 24, h: 9}
        position: {x: 0, y: 26}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: row_operations
            type: values
            size: 10
          metrics:
            - formula: counter_rate(max(mysql.row_operations))
              label: Row Ops/sec
      - title: Page Operations
        size: {w: 24, h: 9}
        position: {x: 24, y: 26}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: page_operations
            type: values
            size: 10
          metrics:
            - formula: counter_rate(max(mysql.page_operations))
              label: Page Ops/sec
      - title: InnoDB Operations (fsyncs, reads, writes)
        size: {w: 24, h: 9}
        position: {x: 0, y: 35}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: operations
            type: values
            size: 10
          metrics:
            - formula: counter_rate(max(mysql.operations))
              label: Operations/sec
      - title: Double Writes
        size: {w: 24, h: 9}
        position: {x: 24, y: 35}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: double_writes
            type: values
            size: 10
          metrics:
            - formula: counter_rate(max(mysql.double_writes))
              label: Double Writes/sec

      # Handler Operations Section (y=44)
      - title: Top Handler Operations
        size: {w: 48, h: 9}
        position: {x: 0, y: 44}
        description: Top 10 handler operations by count
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: handler
            type: values
            size: 10
          metrics:
            - formula: counter_rate(max(mysql.handlers))
              label: Handler Ops/sec

      # Locks & Waits Section (y=53)
      - title: Lock Waits
        size: {w: 24, h: 9}
        position: {x: 0, y: 53}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: locks
            type: values
            size: 10
          metrics:
            - formula: counter_rate(max(mysql.locks))
              label: Locks/sec
      - title: Row Lock Waits
        size: {w: 24, h: 9}
        position: {x: 24, y: 53}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: row_locks
            type: values
            size: 10
          metrics:
            - field: mysql.row_locks
              aggregation: max
              label: Row Lock Waits

      # Log Operations Section (y=62)
      - title: Log Operations
        size: {w: 48, h: 9}
        position: {x: 0, y: 62}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: log_operations
            type: values
            size: 10
          metrics:
            - formula: counter_rate(max(mysql.log_operations))
              label: Log Ops/sec

      # Table I/O Waits Section (y=71)
      - title: Table I/O Wait Count (Top 10 Tables)
        size: {w: 24, h: 9}
        position: {x: 0, y: 71}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          filters:
            - exists: mysql.table.io.wait.count
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: table_name
            type: values
            size: 10
          metrics:
            - formula: counter_rate(max(mysql.table.io.wait.count))
              label: Table I/O Waits/sec
      - title: Index I/O Wait Count (Top 10 Indexes)
        size: {w: 24, h: 9}
        position: {x: 24, y: 71}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          filters:
            - exists: mysql.index.io.wait.count
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: index_name
            type: values
            size: 10
          metrics:
            - formula: counter_rate(max(mysql.index.io.wait.count))
              label: Index I/O Waits/sec

      # Resources Section (y=80)
      - title: Opened Resources
        size: {w: 24, h: 9}
        position: {x: 0, y: 80}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: opened_resources
            type: values
            size: 10
          metrics:
            - formula: counter_rate(max(mysql.opened_resources))
              label: Opened Resources/sec
      - title: Temporary Resources
        size: {w: 24, h: 9}
        position: {x: 24, y: 80}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: tmp_resources
            type: values
            size: 10
          metrics:
            - formula: counter_rate(max(mysql.tmp_resources))
              label: Temp Resources/sec

      # Threads & Sorts Section (y=89)
      - title: Thread Metrics
        size: {w: 24, h: 9}
        position: {x: 0, y: 89}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: threads
            type: values
            size: 10
          metrics:
            - field: mysql.threads
              aggregation: max
              label: Threads
      - title: Sort Operations
        size: {w: 24, h: 9}
        position: {x: 24, y: 89}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: sorts
            type: values
            size: 10
          metrics:
            - formula: counter_rate(max(mysql.sorts))
              label: Sorts/sec

      # Uptime & Connection Stats (y=98)
      - title: MySQL Uptime
        size: {w: 24, h: 9}
        position: {x: 0, y: 98}
        lens:
          type: line
          data_view: metrics-*
          dimension:
            field: '@timestamp'
            type: date_histogram
          metrics:
            - field: mysql.uptime
              aggregation: max
              label: Uptime (seconds)
      - title: MySQLx Connections
        size: {w: 24, h: 9}
        position: {x: 24, y: 98}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: mysqlx_connections
            type: values
            size: 10
          metrics:
            - formula: counter_rate(max(mysql.mysqlx_connections))
              label: MySQLx Connections/sec

      # Info Panel about Disabled Metrics (y=107)
      - size: {w: 48, h: 6}
        position: {x: 0, y: 107}
        markdown:
          content: |
            ## Disabled Metrics (Not Available by Default)
            The following metrics are **disabled by default** in the MySQL receiver and require explicit configuration to enable:
            - **Connection Metrics**: `mysql.connection.count`, `mysql.connection.errors`, `mysql.max_used_connections`
            - **Query Metrics**: `mysql.query.count`, `mysql.query.slow.count`, `mysql.query.client.count`
            - **Replication**: `mysql.replica.time_behind_source`, `mysql.replica.sql_delay`
            - **Table Metrics**: `mysql.table.rows`, `mysql.table.size`, `mysql.table.average_row_length`
            - **Command Metrics**: `mysql.commands`
            To enable these metrics, update your MySQL receiver configuration in the OpenTelemetry Collector.
          font_size: 12
