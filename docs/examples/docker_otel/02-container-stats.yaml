---
# Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one
# or more contributor license agreements. Licensed under the Elastic License 2.0;
# you may not use this file except in compliance with the Elastic License 2.0.
# See ../../../licenses/ELASTIC-LICENSE-2.0.txt for the full license text.
#
# This file is derived from the Elastic integrations repository:
# https://github.com/elastic/integrations/tree/main/packages/docker_otel
#
# Modified by kb-yaml-to-lens contributors to convert from Kibana JSON format
# to YAML format for use as documentation examples.
dashboards:
  - id: docker-otel-container-stats
    name: '[Metrics Docker] Container Stats'
    description: ''
    controls:
      - type: options
        label: Container image
        data_view: metrics-*
        field: container.image.name
      - type: options
        label: Container name
        data_view: metrics-*
        field: container.name
      - type: options
        label: Container hostname
        data_view: metrics-*
        field: container.hostname
      - type: options
        label: Container ID
        data_view: metrics-*
        field: container.id
    filters:
      - field: data_stream.dataset
        equals: dockerstatsreceiver.otel
    panels:
      # Navigation Links
      - title: Navigation Links
        grid: {x: 0, y: 0, w: 48, h: 2}
        links:
          layout: horizontal
          items:
            - label: Overview
              dashboard: docker-otel-overview
            - label: Container Stats
              dashboard: docker-otel-container-stats

      # Warning markdown panel
      - grid: {x: 0, y: 2, w: 48, h: 2}
        markdown:
          content: This dashboard is only intended to be used when filtered to one container at a time.
          font_size: 12

      # Container count metric
      - title: Containers count
        grid: {x: 0, y: 4, w: 7, h: 4}
        hide_title: true
        lens:
          type: metric
          data_view: metrics-*
          primary:
            field: container.id
            aggregation: unique_count
            label: Selected Containers

      # Container info table
      - title: Container info
        grid: {x: 7, y: 4, w: 41, h: 4}
        lens:
          type: datatable
          data_view: metrics-*
          dimensions:
            - id: container-name
              type: values
              field: container.name
              label: Container Name
              size: 3
            - id: container-image
              type: values
              field: container.image.name
              label: Container Image
              size: 3
            - id: container-runtime
              type: values
              field: container.runtime
              label: Runtime
              size: 3
            - id: container-id
              type: values
              field: container.id
              label: Container ID
              size: 3
            - id: container-hostname
              type: values
              field: container.hostname
              label: Hostname
              size: 5
          metrics:
            - id: cpu-usage
              formula: median(container.cpu.utilization)/100
              label: CPU Usage
              format:
                type: percent
            - id: memory-usage
              formula: median(container.memory.percent)/100
              label: Memory Usage
              format:
                type: percent
            - id: memory-bytes
              field: container.memory.usage.total
              aggregation: median
              label: Memory (Bytes)
              format:
                type: bytes

      # CPU Usage (line chart) - y=8
      - title: CPU Usage
        grid: {x: 0, y: 8, w: 48, h: 9}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          dimension:
            field: '@timestamp'
            type: date_histogram
          metrics:
            - formula: median(container.cpu.utilization)/100
              label: CPU Usage
              format:
                type: percent

      # Memory Usage (line chart) - y=17
      - title: Memory Usage
        grid: {x: 0, y: 17, w: 48, h: 9}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: hide
          dimension:
            field: '@timestamp'
            type: date_histogram
          metrics:
            - field: container.memory.usage.total
              aggregation: median
              label: Memory Usage
              format:
                type: bytes

      # Disk I/O (line chart by device) - y=26
      - title: Disk I/O
        grid: {x: 0, y: 26, w: 48, h: 9}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: attributes.device_major
            type: values
            size: 1000
          metrics:
            - formula: counter_rate(max(container.blockio.io_service_bytes_recursive))
              label: Bytes
              format:
                type: bytes

      # Network I/O (line chart with rx and tx) - y=35
      - title: Network I/O
        grid: {x: 0, y: 35, w: 48, h: 9}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: attributes.interface
            type: values
            size: 30
          metrics:
            - formula: counter_rate(max(container.network.io.usage.rx_bytes))
              label: Received Bytes
              format:
                type: bytes
            - formula: counter_rate(max(container.network.io.usage.tx_bytes))
              label: Transmitted Bytes
              format:
                type: bytes

      # "Detailed information" markdown panel - y=44
      - grid: {x: 0, y: 44, w: 48, h: 3}
        markdown:
          content: '## Detailed information'
          font_size: 12

      # CPU Usage (area stacked chart) - y=47
      - title: CPU Usage
        grid: {x: 0, y: 47, w: 48, h: 9}
        lens:
          type: area
          mode: stacked
          data_view: metrics-*
          legend:
            visible: show
            position: right
          dimension:
            field: '@timestamp'
            type: date_histogram
          metrics:
            - formula: median(container.cpu.utilization)/100
              label: CPU %
              format:
                type: percent

      # Memory Usage with limit (line chart) - y=56 left
      - title: Memory Usage with limit
        grid: {x: 0, y: 56, w: 24, h: 9}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: hide
          dimension:
            field: '@timestamp'
            type: date_histogram
          metrics:
            - field: container.memory.usage.total
              aggregation: median
              label: Memory Usage
              format:
                type: bytes
            - field: container.memory.usage.limit
              aggregation: median
              label: Memory Limit
              format:
                type: bytes

      # Memory Usage (line chart percentage) - y=56 right
      - title: Memory Usage
        grid: {x: 24, y: 56, w: 24, h: 9}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: hide
          dimension:
            field: '@timestamp'
            type: date_histogram
          metrics:
            - formula: median(container.memory.percent)/100
              label: Memory %
              format:
                type: percent

      # Disk I/O (line chart by device) - y=65
      # Note: This is NOT a duplicate - it's a second visualization of disk I/O
      - title: Disk I/O
        grid: {x: 0, y: 65, w: 48, h: 9}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: attributes.device_major
            type: values
            size: 1000
          metrics:
            - formula: counter_rate(max(container.blockio.io_service_bytes_recursive))
              label: Bytes
              format:
                type: bytes

      # Network - Received Bytes (line chart) - y=74 left
      - title: Network - Received Bytes
        grid: {x: 0, y: 74, w: 24, h: 9}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: attributes.interface
            type: values
            size: 30
          metrics:
            - formula: counter_rate(max(container.network.io.usage.rx_bytes))
              label: Bytes
              format:
                type: bytes

      # Network - Transmitted Bytes (line chart) - y=74 right
      - title: Network - Transmitted Bytes
        grid: {x: 24, y: 74, w: 24, h: 9}
        lens:
          type: line
          data_view: metrics-*
          legend:
            visible: show
            position: right
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: attributes.interface
            type: values
            size: 30
          metrics:
            - formula: counter_rate(max(container.network.io.usage.tx_bytes))
              label: Bytes
              format:
                type: bytes
