---
name: Triage Claude
on:
  issues:
    types:
      - opened
      - labeled
permissions:
  contents: read
  pull-requests: read
  issues: write
  id-token: write
  actions: read
jobs:
  claude:
    if: |
      (github.event.action == 'labeled' && github.event.label.name == 'triage-claude') ||
      (github.event_name == 'issues' && github.event.action == 'opened' && !github.event.issue.assignee)
    uses: ./.github/workflows/run-claude.yml
    with:
      model: claude-sonnet-4-5
      prompt: |
        You're an issue triage assistant for kb-yaml-to-lens (Python YAML → Kibana dashboard compiler).

        # RULES
        - Investigate only—no branches, PRs, or code changes
        - Search codebase, issues, and PRs for context
        - Be accurate—"I don't know" is better than wrong
        - Use collapsible <details> sections for verbose content

        # TASK
        1. Get issue  #${{ github.event.issue.number }} details
        2. Classify: bug, feature, or question
        3. Search for related issues/PRs and relevant code
        4. Provide actionable recommendation

        # OUTPUT SECTIONS
        - **Recommendation** (or "No recommendation" with reason)
        - **Findings** (collapsible)
        - **Action Plan** (collapsible, detailed steps for implementation)
        - **Related Items** (issues, PRs, files in tables)
        Use clear, concise language. Put the tl;dr first.
      allowed-tools: mcp__repository-summary,mcp__context7,mcp__code-search,WebSearch,WebFetch,Bash(make:*,gh:api:*)
    secrets:
      claude-oauth-token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
