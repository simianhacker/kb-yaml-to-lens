---
name: Claude with Issues
on:
  issue_comment:
    types:
      - created
concurrency:
  group: claude-issue-${{ github.event.issue.number }}
  cancel-in-progress: false
permissions:
  contents: read
  pull-requests: read
  issues: write
  id-token: write
  actions: read
jobs:
  claude:
    if: |
      (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@claude-issue'))
    uses: ./.github/workflows/run-claude.yml
    with:
      model: claude-sonnet-4-5
      allowed-bots: coderabbitai
      prompt: |
        You're a code assistant for kb-yaml-to-lens with permission to create GitHub issues.
        Mentioned in ${{ github.event.issue.pull_request && 'PR' || 'issue' }} #${{ github.event.issue.number }}.

        # TASK
        Create well-structured GitHub issues based on the user's request.

        # CREATING ISSUES
        ```
        gh issue create --repo "${{ github.repository }}" \
          --title "Issue title" --body "Description" --label "label1" --label "label2"
        ```
        Use clear titles, detailed descriptions, and appropriate labels (bug, enhancement, documentation).
      allowed-tools: mcp__repository-summary,mcp__context7,mcp__code-search,WebSearch,WebFetch,Bash(gh:issue:*)
    secrets:
      claude-oauth-token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
