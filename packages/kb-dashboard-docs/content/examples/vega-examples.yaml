---
dashboards:
  - id: vega-examples-001
    name: '[Example] Vega Visualizations'
    description: Comprehensive examples of Vega and Vega-Lite custom visualization configurations
    panels:
      - title: Vega Examples Overview
        size:
          w: 48
          h: 6
        position:
          x: 0
          y: 0
        markdown:
          content: |
            # Vega Visualization Examples
            This dashboard demonstrates various Vega and Vega-Lite configurations:
            - **Hello Vega** - Minimal static visualization
            - **Bar Charts** - Vertical and horizontal bar charts
            - **Time Series** - Line and area charts with temporal data
            - **Multi-Series** - Multiple lines with color encoding
            - **Scatter Plots** - Comparing two quantitative dimensions
            - **Pie/Donut Charts** - Arc marks for proportional data
            - **Sankey Diagram** - Flow visualization between services
            Vega panels are perfect for custom visualizations not available in Lens.

      # Minimal Hello Vega
      - title: Hello Vega
        description: A minimal Vega visualization showing static text
        size:
          w: 24
          h: 10
        position:
          x: 0
          y: 6
        vega:
          spec:
            $schema: https://vega.github.io/schema/vega/v3.json
            width: 300
            height: 100
            marks:
              - type: text
                encode:
                  enter:
                    x:
                      value: 150
                    y:
                      value: 50
                    text:
                      value: Hello Vega!
                    fontSize:
                      value: 24
                    align:
                      value: center
                    fill:
                      value: '#1a1a1a'

      # Vega-Lite Bar Chart
      - title: Simple Bar Chart (Vega-Lite)
        description: Bar chart using Vega-Lite with inline data
        size:
          w: 24
          h: 10
        position:
          x: 24
          y: 6
        vega:
          spec:
            $schema: https://vega.github.io/schema/vega-lite/v5.json
            description: A simple bar chart with inline data
            data:
              values:
                - category: A
                  amount: 28
                - category: B
                  amount: 55
                - category: C
                  amount: 43
                - category: D
                  amount: 91
                - category: E
                  amount: 81
            mark: bar
            encoding:
              x:
                field: category
                type: nominal
                axis:
                  labelAngle: 0
              y:
                field: amount
                type: quantitative

      # Elasticsearch Time Series
      - title: Time Series from Elasticsearch
        description: Line chart querying data from Elasticsearch index
        size:
          w: 24
          h: 15
        position:
          x: 0
          y: 16
        vega:
          spec:
            $schema: https://vega.github.io/schema/vega-lite/v5.json
            data:
              url:
                '%context%': true
                '%timefield%': '@timestamp'
                index: logs-*
                body:
                  size: 0
                  aggs:
                    time_buckets:
                      date_histogram:
                        field: '@timestamp'
                        fixed_interval: 1h
            format:
              property: aggregations.time_buckets.buckets
            mark: line
            encoding:
              x:
                field: key
                type: temporal
                title: Time
              y:
                field: doc_count
                type: quantitative
                title: Event Count

      # Multi-Series Line Chart
      - title: Multi-Series by Service
        description: Multiple lines showing trends per service
        size:
          w: 24
          h: 15
        position:
          x: 24
          y: 16
        vega:
          spec:
            $schema: https://vega.github.io/schema/vega-lite/v5.json
            data:
              url:
                '%context%': true
                '%timefield%': '@timestamp'
                index: logs-*
                body:
                  size: 0
                  aggs:
                    services:
                      terms:
                        field: service.name
                        size: 5
                      aggs:
                        over_time:
                          date_histogram:
                            field: '@timestamp'
                            fixed_interval: 1h
            transform:
              - flatten:
                  - buckets
                as:
                  - time_bucket
            format:
              property: aggregations.services.buckets
            mark: line
            encoding:
              x:
                field: time_bucket.key
                type: temporal
                title: Time
              y:
                field: time_bucket.doc_count
                type: quantitative
                title: Count
              color:
                field: key
                type: nominal
                title: Service

      # Area Chart with Gradient
      - title: Area Chart with Gradient Fill
        description: Styled area chart showing traffic volume
        size:
          w: 24
          h: 15
        position:
          x: 0
          y: 31
        vega:
          spec:
            $schema: https://vega.github.io/schema/vega-lite/v5.json
            data:
              url:
                '%context%': true
                '%timefield%': '@timestamp'
                index: logs-*
                body:
                  size: 0
                  aggs:
                    time_buckets:
                      date_histogram:
                        field: '@timestamp'
                        fixed_interval: 30m
            format:
              property: aggregations.time_buckets.buckets
            mark:
              type: area
              line: true
              opacity: 0.7
            encoding:
              x:
                field: key
                type: temporal
                title: Time
              y:
                field: doc_count
                type: quantitative
                title: Volume

      # Horizontal Bar Chart
      - title: Top Endpoints by Request Count
        description: Horizontal bar chart showing top 10 endpoints
        size:
          w: 24
          h: 15
        position:
          x: 24
          y: 31
        vega:
          spec:
            $schema: https://vega.github.io/schema/vega-lite/v5.json
            data:
              url:
                '%context%': true
                '%timefield%': '@timestamp'
                index: logs-*
                body:
                  size: 0
                  aggs:
                    endpoints:
                      terms:
                        field: url.path
                        size: 10
            format:
              property: aggregations.endpoints.buckets
            mark: bar
            encoding:
              y:
                field: key
                type: nominal
                title: Endpoint
                sort: -x
              x:
                field: doc_count
                type: quantitative
                title: Request Count

      # Scatter Plot
      - title: Response Time vs Payload Size
        description: Scatter plot comparing metrics
        size:
          w: 24
          h: 15
        position:
          x: 0
          y: 46
        vega:
          spec:
            $schema: https://vega.github.io/schema/vega-lite/v5.json
            data:
              url:
                '%context%': true
                '%timefield%': '@timestamp'
                index: logs-*
                body:
                  size: 500
                  _source:
                    - http.response.body.bytes
                    - event.duration
                    - service.name
            format:
              property: hits.hits
            transform:
              - calculate: datum._source['http.response.body.bytes']
                as: bytes
              - calculate: datum._source['event.duration'] / 1000000
                as: duration_ms
              - calculate: datum._source['service.name']
                as: service
            mark:
              type: circle
              opacity: 0.6
            encoding:
              x:
                field: bytes
                type: quantitative
                title: Response Size (bytes)
              y:
                field: duration_ms
                type: quantitative
                title: Duration (ms)
              color:
                field: service
                type: nominal
                title: Service

      # Pie Chart
      - title: Request Distribution by Status
        description: Pie chart showing HTTP status code distribution
        size:
          w: 24
          h: 15
        position:
          x: 24
          y: 46
        vega:
          spec:
            $schema: https://vega.github.io/schema/vega-lite/v5.json
            data:
              url:
                '%context%': true
                '%timefield%': '@timestamp'
                index: logs-*
                body:
                  size: 0
                  aggs:
                    status_codes:
                      terms:
                        field: http.response.status_code
                        size: 10
            format:
              property: aggregations.status_codes.buckets
            mark:
              type: arc
              innerRadius: 50
            encoding:
              theta:
                field: doc_count
                type: quantitative
              color:
                field: key
                type: nominal
                title: Status Code

      # Sankey Diagram - Full Vega (not Vega-Lite)
      # To query Elasticsearch for service-to-service traffic, you could use:
      #   - name: links
      #     url:
      #       '%context%': true
      #       '%timefield%': '@timestamp'
      #       index: traces-*
      #       body:
      #         size: 0
      #         aggs:
      #           sources:
      #             terms:
      #               field: service.name
      #               size: 20
      #             aggs:
      #               targets:
      #                 terms:
      #                   field: destination.service.name
      #                   size: 20
      #     format:
      #       property: aggregations.sources.buckets
      #     transform:
      #       - type: flatten
      #         fields: [targets.buckets]
      #         as: [target]
      #       - type: formula
      #         as: source
      #         expr: datum.key
      #       - type: formula
      #         as: targetName
      #         expr: datum.target.key
      #       - type: formula
      #         as: value
      #         expr: datum.target.doc_count
      # Note: Sankey requires computing node positions from the data, which adds complexity.
      # The inline example below uses pre-computed positions for simplicity.
      - title: Request Flow Through Services
        description: Sankey diagram showing traffic flow between services
        size:
          w: 48
          h: 20
        position:
          x: 0
          y: 61
        vega:
          spec:
            $schema: https://vega.github.io/schema/vega/v5.json
            autosize: none
            width: 800
            height: 350
            padding: 10
            data:
              - name: nodes
                values:
                  - id: lb
                    name: Load Balancer
                    x: 50
                    y: 150
                  - id: api
                    name: API Gateway
                    x: 200
                    y: 150
                  - id: auth
                    name: Auth Service
                    x: 350
                    y: 50
                  - id: user
                    name: User Service
                    x: 350
                    y: 150
                  - id: order
                    name: Order Service
                    x: 350
                    y: 250
                  - id: session
                    name: Session Cache
                    x: 500
                    y: 30
                  - id: cache
                    name: Cache
                    x: 500
                    y: 100
                  - id: db
                    name: Database
                    x: 500
                    y: 180
                  - id: payment
                    name: Payment
                    x: 500
                    y: 260
                  - id: external
                    name: External API
                    x: 650
                    y: 260
              - name: links
                values:
                  - source: lb
                    target: api
                    value: 45000
                    sx: 90
                    sy: 170
                    tx: 200
                    ty: 170
                  - source: api
                    target: auth
                    value: 12000
                    sx: 240
                    sy: 150
                    tx: 350
                    ty: 70
                  - source: api
                    target: user
                    value: 18000
                    sx: 240
                    sy: 170
                    tx: 350
                    ty: 170
                  - source: api
                    target: order
                    value: 15000
                    sx: 240
                    sy: 190
                    tx: 350
                    ty: 270
                  - source: auth
                    target: session
                    value: 4000
                    sx: 390
                    sy: 60
                    tx: 500
                    ty: 50
                  - source: auth
                    target: cache
                    value: 8000
                    sx: 390
                    sy: 80
                    tx: 500
                    ty: 120
                  - source: user
                    target: cache
                    value: 6000
                    sx: 390
                    sy: 160
                    tx: 500
                    ty: 130
                  - source: user
                    target: db
                    value: 20000
                    sx: 390
                    sy: 180
                    tx: 500
                    ty: 200
                  - source: order
                    target: db
                    value: 10000
                    sx: 390
                    sy: 260
                    tx: 500
                    ty: 210
                  - source: order
                    target: payment
                    value: 5000
                    sx: 390
                    sy: 280
                    tx: 500
                    ty: 280
                  - source: payment
                    target: external
                    value: 5000
                    sx: 540
                    sy: 280
                    tx: 650
                    ty: 280
            scales:
              - name: color
                type: ordinal
                domain:
                  data: nodes
                  field: name
                range: category
            marks:
              - type: path
                from:
                  data: links
                encode:
                  enter:
                    stroke:
                      value: '#6baed6'
                    strokeWidth:
                      signal: max(datum.value / 3000, 3)
                    strokeOpacity:
                      value: 0.6
                    path:
                      signal: "'M' + datum.sx + ',' + datum.sy + ' C' + (datum.sx + 50) + ',' + datum.sy + ' ' + (datum.tx - 50) + ',' + datum.ty + ' ' + datum.tx + ',' + datum.ty"
              - type: rect
                from:
                  data: nodes
                encode:
                  enter:
                    x:
                      field: x
                    y:
                      field: y
                    width:
                      value: 40
                    height:
                      value: 40
                    fill:
                      scale: color
                      field: name
                    cornerRadius:
                      value: 6
                    stroke:
                      value: '#fff'
                    strokeWidth:
                      value: 2
                  update:
                    tooltip:
                      field: name
              - type: text
                from:
                  data: nodes
                encode:
                  enter:
                    x:
                      signal: datum.x + 20
                    y:
                      signal: datum.y - 8
                    text:
                      field: name
                    fontSize:
                      value: 11
                    fontWeight:
                      value: bold
                    align:
                      value: center
                    fill:
                      value: '#333'
