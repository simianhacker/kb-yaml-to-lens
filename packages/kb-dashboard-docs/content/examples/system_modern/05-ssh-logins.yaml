---
# Modern System SSH Logins Dashboard
# Following Dashboard Style Guide best practices:
# - Security dashboard pattern: overview → trends → breakdowns → audit log
# - Success/failure metrics for quick status
# - Source IP analysis via stacked bar chart
# - Stacked bar for event types over time
# - Detailed audit table at bottom
dashboards:
  - id: system-modern-ssh-logins
    name: '[Logs System] SSH Logins'
    description: >-
      SSH authentication analysis with success/failure tracking.
      Monitor login attempts, users, and source locations.
    filters:
      - exists: system.auth.ssh.event
    controls:
      - type: options
        label: Hostname
        data_view: logs-*
        field: host.hostname
      - type: options
        label: SSH Event
        data_view: logs-*
        field: system.auth.ssh.event
      - type: options
        label: User
        data_view: logs-*
        field: user.name
    panels:
      # Context Layer - Navigation
      - title: System Log Dashboards
        size: {w: 48, h: 3}
        links:
          layout: horizontal
          items:
            - label: Metrics Overview
              dashboard: system-modern-metrics-overview
            - label: Syslog
              dashboard: system-modern-syslog
            - label: Sudo Commands
              dashboard: system-modern-sudo-commands
            - label: SSH Logins
              dashboard: system-modern-ssh-logins
            - label: Users & Groups
              dashboard: system-modern-users-groups

      # Summary Layer - Key Security Metrics
      - title: Total Attempts
        size: {w: 12, h: 4}
        lens:
          type: metric
          data_view: logs-*
          primary:
            aggregation: count
            label: Attempts
      - title: Accepted Logins
        size: {w: 12, h: 4}
        lens:
          type: metric
          data_view: logs-*
          primary:
            aggregation: count
            label: Accepted
          filters:
            - field: system.auth.ssh.event
              equals: Accepted
      - title: Failed Logins
        size: {w: 12, h: 4}
        lens:
          type: metric
          data_view: logs-*
          primary:
            aggregation: count
            label: Failed
          filters:
            - field: system.auth.ssh.event
              equals: Failed
      - title: Unique Users
        size: {w: 12, h: 4}
        lens:
          type: metric
          data_view: logs-*
          primary:
            aggregation: unique_count
            field: user.name
            label: Users

      # Analysis Layer - Time Series
      - title: SSH Login Attempts Over Time
        size: {w: 48, h: 12}
        lens:
          type: bar
          mode: stacked
          data_view: logs-*
          dimension:
            field: '@timestamp'
            type: date_histogram
          metrics:
            - aggregation: count
              label: Attempts
          breakdown:
            type: values
            field: system.auth.ssh.event
            size: 10

      # Analysis Layer - Categorical Breakdowns
      - title: SSH Event Types
        size: {w: 12, h: 12}
        lens:
          type: pie
          data_view: logs-*
          dimensions:
            - type: values
              field: system.auth.ssh.event
              size: 10
          metrics:
            - aggregation: count
              label: Events
      - title: Authentication Methods
        size: {w: 12, h: 12}
        lens:
          type: pie
          data_view: logs-*
          dimensions:
            - type: values
              field: system.auth.ssh.method
              size: 10
          metrics:
            - aggregation: count
              label: Attempts
      - title: Top Users
        size: {w: 24, h: 12}
        lens:
          type: bar
          mode: stacked
          data_view: logs-*
          dimension:
            type: values
            field: user.name
            size: 10
            sort:
              by: Attempts
              direction: desc
          metrics:
            - aggregation: count
              label: Attempts
          breakdown:
            type: values
            field: system.auth.ssh.event
            size: 5

      # Analysis Layer - Source Analysis
      - title: Login Attempts by Source IP
        size: {w: 24, h: 15}
        lens:
          type: bar
          mode: stacked
          data_view: logs-*
          dimension:
            type: values
            field: source.ip
            size: 10
            sort:
              by: Attempts
              direction: desc
          metrics:
            - aggregation: count
              label: Attempts
          breakdown:
            type: values
            field: system.auth.ssh.event
            size: 5
      - title: User and Event Distribution
        size: {w: 24, h: 15}
        lens:
          type: pie
          data_view: logs-*
          dimensions:
            - type: values
              field: system.auth.ssh.event
              size: 5
            - type: values
              field: user.name
              size: 10
          metrics:
            - aggregation: count
              label: Attempts

      # Detail Layer - Audit Log Table
      - title: SSH Login Audit Log
        size: {w: 48, h: 18}
        lens:
          type: datatable
          data_view: logs-*
          dimensions:
            - id: timestamp
              field: '@timestamp'
              type: date_histogram
            - id: hostname
              type: values
              field: host.hostname
            - id: event
              type: values
              field: system.auth.ssh.event
            - id: user
              type: values
              field: user.name
            - id: sourceip
              type: values
              field: source.ip
            - id: method
              type: values
              field: system.auth.ssh.method
          metrics:
            - id: count
              aggregation: count
              label: Count
          paging:
            enabled: true
            page_size: 10
