---
# Kubernetes Workload Health Dashboard
# SRE Question: "Are my deployments healthy? What's crashing?"
dashboards:
  - id: k8s-cluster-workloads
    name: '[Metrics K8s Cluster] Workload Health'
    description: Deployment, StatefulSet, DaemonSet, and container health monitoring
    controls:
      - type: options
        label: Namespace
        data_view: metrics-*
        field: k8s.namespace.name
      - type: options
        label: Deployment
        data_view: metrics-*
        field: k8s.deployment.name
    filters:
      - field: data_stream.dataset
        equals: kubernetesclusterreceiver.otel
    panels:
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # NAVIGATION
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - title: Navigation
        size: {w: 48, h: 3}
        links:
          layout: horizontal
          items:
            - label: ğŸ“Š Overview
              dashboard: k8s-cluster-overview
            - label: âš™ï¸ Workloads
              dashboard: k8s-cluster-workloads
            - label: ğŸ“¦ Resources
              dashboard: k8s-cluster-resources
            - label: ğŸ”„ Batch Jobs
              dashboard: k8s-cluster-batch
            - label: ğŸ“ˆ Autoscaling
              dashboard: k8s-cluster-hpa

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # CONTAINER HEALTH SUMMARY (4 metric cards)
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - title: Container Health
        size: {w: 48, h: 3}
        markdown:
          content: '## ğŸ³ Container Health'
          font_size: 14
      - title: Ready Containers
        description: Containers with all startup and liveness probes passing. Can receive traffic.
        hide_title: true
        size: {w: 12, h: 4}
        lens:
          type: metric
          data_view: metrics-*
          primary:
            formula: unique_count(k8s.container.name)
            label: Ready
            format:
              type: number
              decimals: 0
          filters:
            - field: k8s.container.ready
              equals: '1'
      - title: Not Ready Containers
        description: >-
          Containers failing probes. Check pod logs and events for startup or
          health issues.
        hide_title: true
        size: {w: 12, h: 4}
        lens:
          type: metric
          data_view: metrics-*
          primary:
            formula: unique_count(k8s.container.name)
            label: Not Ready
            format:
              type: number
              decimals: 0
          filters:
            - field: k8s.container.ready
              equals: '0'
      - title: Total Restarts
        hide_title: true
        size: {w: 12, h: 4}
        lens:
          type: metric
          data_view: metrics-*
          primary:
            formula: sum(k8s.container.restarts)
            label: Restarts
            format:
              type: number
              decimals: 0
          filters:
            - exists: k8s.container.restarts
      - title: Containers Restarting
        description: >-
          Containers that have restarted at least once since pod creation.
          Frequent restarts indicate instability.
        hide_title: true
        size: {w: 12, h: 4}
        lens:
          type: metric
          data_view: metrics-*
          primary:
            formula: unique_count(k8s.container.name)
            label: With Restarts
            format:
              type: number
              decimals: 0
          filters:
            - field: k8s.container.restarts
              gt: '0'

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # DEPLOYMENT HEALTH
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - title: Deployment Health
        size: {w: 48, h: 3}
        markdown:
          content: '## ğŸš€ Deployment Health (Desired vs Available)'
          font_size: 14
      - title: Deployments
        size: {w: 24, h: 12}
        lens:
          type: line
          data_view: metrics-*
          dimension:
            field: '@timestamp'
            type: date_histogram
          metrics:
            - formula: sum(k8s.deployment.desired)
              label: Desired
              format:
                type: number
                decimals: 0
            - formula: sum(k8s.deployment.available)
              label: Available
              format:
                type: number
                decimals: 0
          filters:
            - exists: k8s.deployment.name
      - title: StatefulSets
        size: {w: 24, h: 12}
        lens:
          type: line
          data_view: metrics-*
          dimension:
            field: '@timestamp'
            type: date_histogram
          metrics:
            - formula: sum(k8s.statefulset.desired_pods)
              label: Desired
              format:
                type: number
                decimals: 0
            - formula: sum(k8s.statefulset.ready_pods)
              label: Ready
              format:
                type: number
                decimals: 0
          filters:
            - exists: k8s.statefulset.name
      - title: DaemonSets
        size: {w: 24, h: 12}
        lens:
          type: line
          data_view: metrics-*
          dimension:
            field: '@timestamp'
            type: date_histogram
          metrics:
            - formula: sum(k8s.daemonset.desired_scheduled_nodes)
              label: Desired Nodes
              format:
                type: number
                decimals: 0
            - formula: sum(k8s.daemonset.ready_nodes)
              label: Ready Nodes
              format:
                type: number
                decimals: 0
          filters:
            - exists: k8s.daemonset.name
      - title: ReplicaSets
        size: {w: 24, h: 12}
        lens:
          type: line
          data_view: metrics-*
          dimension:
            field: '@timestamp'
            type: date_histogram
          metrics:
            - formula: sum(k8s.replicaset.desired)
              label: Desired
              format:
                type: number
                decimals: 0
            - formula: sum(k8s.replicaset.available)
              label: Available
              format:
                type: number
                decimals: 0
          filters:
            - exists: k8s.replicaset.name

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # CONTAINER ANALYSIS
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - title: Container Analysis
        size: {w: 48, h: 3}
        markdown:
          content: '## ğŸ“Š Container Analysis'
          font_size: 14
      - title: Container Readiness Over Time
        description: >-
          Green (1) = ready, red (0) = not ready. Correlate dips with
          deployments or incidents.
        size: {w: 24, h: 12}
        lens:
          type: area
          mode: stacked
          data_view: metrics-*
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            field: k8s.container.ready
            type: values
            size: 2
          metrics:
            - aggregation: unique_count
              field: k8s.container.name
              label: Containers
              format:
                type: number
                decimals: 0
          color:
            palette: eui_amsterdam_color_blind
            assignments:
              - value: '1'
                color: '#54B399'
              - value: '0'
                color: '#D36086'
      - title: Top Restarting Containers
        size: {w: 24, h: 12}
        lens:
          type: bar
          data_view: metrics-*
          dimension:
            field: k8s.container.name
            type: values
            size: 15
            sort:
              by: Restarts
              direction: desc
          metrics:
            - field: k8s.container.restarts
              aggregation: max
              label: Restarts
              format:
                type: number
                decimals: 0
          filters:
            - field: k8s.container.restarts
              gt: '0'

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # DETAIL TABLES
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - title: Workload Details
        size: {w: 48, h: 3}
        markdown:
          content: '## ğŸ” Workload Status Details'
          font_size: 14
      - title: Deployment Status
        size: {w: 24, h: 12}
        lens:
          type: datatable
          data_view: metrics-*
          dimensions:
            - field: k8s.deployment.name
              type: values
              size: 20
              label: Deployment
            - field: k8s.namespace.name
              type: values
              size: 1
              label: Namespace
          metrics:
            - field: k8s.deployment.desired
              aggregation: max
              label: Desired
              format:
                type: number
                decimals: 0
            - field: k8s.deployment.available
              aggregation: max
              label: Available
              format:
                type: number
                decimals: 0
          filters:
            - exists: k8s.deployment.name
      - title: StatefulSet Status
        size: {w: 24, h: 12}
        lens:
          type: datatable
          data_view: metrics-*
          dimensions:
            - field: k8s.statefulset.name
              type: values
              size: 20
              label: StatefulSet
            - field: k8s.namespace.name
              type: values
              size: 1
              label: Namespace
          metrics:
            - field: k8s.statefulset.desired_pods
              aggregation: max
              label: Desired
              format:
                type: number
                decimals: 0
            - field: k8s.statefulset.ready_pods
              aggregation: max
              label: Ready
              format:
                type: number
                decimals: 0
            - field: k8s.statefulset.current_pods
              aggregation: max
              label: Current
              format:
                type: number
                decimals: 0
          filters:
            - exists: k8s.statefulset.name
