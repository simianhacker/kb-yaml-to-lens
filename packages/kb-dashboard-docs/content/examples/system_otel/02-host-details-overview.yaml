---
# Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one
# or more contributor license agreements. Licensed under the Elastic License 2.0;
# you may not use this file except in compliance with the Elastic License 2.0.
# See ../../licenses/ELASTIC-LICENSE-2.0.txt for the full license text.
#
# This file is derived from the Elastic integrations repository:
# https://github.com/elastic/integrations/tree/main/packages/system_otel
#
# Modified by kb-yaml-to-lens contributors to convert from Kibana JSON format
# to YAML format for use as documentation examples.
dashboards:
  - id: otel-host-details-overview
    name: '[OTel System] Host Details - Overview'
    description: Detailed overview of host resource utilization and performance metrics
    filters:
      - exists: resource.attributes.host.name
      - field: data_stream.dataset
        equals: hostmetricsreceiver.otel
    controls:
      - type: options
        label: Host Name
        data_view: metrics-*
        field: resource.attributes.host.name
    panels:
      # ═══════════════════════════════════════════════════════════════════════
      # NAVIGATION
      # ═══════════════════════════════════════════════════════════════════════
      - title: Navigation
        size: {w: 48, h: 3}
        links:
          layout: horizontal
          items:
            - label: Hosts Overview
              dashboard: otel-hosts-overview
            - label: Host Overview
              dashboard: otel-host-details-overview
            - label: Host Metrics
              dashboard: otel-host-details-metrics
            - label: Host Metadata
              dashboard: otel-host-details-metadata
            - label: Host Logs
              dashboard: otel-host-details-logs

      # ═══════════════════════════════════════════════════════════════════════
      # KEY METRICS
      # ═══════════════════════════════════════════════════════════════════════
      - title: Key Metrics
        size: {w: 48, h: 3}
        markdown:
          content: '## Key Metrics'
      - title: CPU Utilization
        hide_title: true
        size: {w: 12, h: 4}
        lens:
          type: metric
          data_view: metrics-*
          primary:
            formula: >-
              1 - (average(metrics.system.cpu.utilization, kql='attributes.state: idle') + average(metrics.system.cpu.utilization, kql='attributes.state:
              wait'))
            label: CPU %
            format:
              type: percent
      - title: Normalized Load
        description: >-
          1-min load average / CPU count. >100% = overloaded. Useful for
          comparing hosts with different CPU counts.
        hide_title: true
        size: {w: 12, h: 4}
        lens:
          type: metric
          data_view: metrics-*
          primary:
            formula: average(metrics.system.cpu.load_average.1m) / max(metrics.system.cpu.logical.count)
            label: Load
            format:
              type: percent
      - title: Memory Utilization
        hide_title: true
        size: {w: 12, h: 4}
        lens:
          type: metric
          data_view: metrics-*
          primary:
            formula: "average(metrics.system.memory.utilization, kql='attributes.state : \"used\"')"
            label: Memory %
            format:
              type: percent
      - title: Disk Usage
        hide_title: true
        size: {w: 12, h: 4}
        lens:
          type: metric
          data_view: metrics-*
          primary:
            aggregation: average
            field: metrics.system.filesystem.utilization
            label: Disk %
            format:
              type: percent

      # ═══════════════════════════════════════════════════════════════════════
      # RESOURCE TRENDS
      # ═══════════════════════════════════════════════════════════════════════
      - title: Resource Trends
        size: {w: 48, h: 3}
        markdown:
          content: '## Resource Trends'
      - title: CPU Utilization Over Time
        size: {w: 24, h: 12}
        lens:
          type: line
          data_view: metrics-*
          dimension:
            field: '@timestamp'
            type: date_histogram
          metrics:
            - formula: >-
                1 - (average(metrics.system.cpu.utilization, kql='attributes.state: idle') + average(metrics.system.cpu.utilization, kql='attributes.state:
                wait'))
              label: CPU Utilization
              format:
                type: percent
      - title: Memory Utilization Over Time
        size: {w: 24, h: 12}
        lens:
          type: area
          data_view: metrics-*
          dimension:
            field: '@timestamp'
            type: date_histogram
          metrics:
            - formula: "average(metrics.system.memory.utilization, kql='attributes.state : \"used\"')"
              label: Memory Utilization
              format:
                type: percent
      - title: Normalized Load Over Time
        size: {w: 24, h: 12}
        lens:
          type: line
          data_view: metrics-*
          dimension:
            field: '@timestamp'
            type: date_histogram
          metrics:
            - formula: average(metrics.system.cpu.load_average.1m) / max(metrics.system.cpu.logical.count)
              label: Normalized Load
              format:
                type: percent
      - title: Disk Usage by Mount Point
        size: {w: 24, h: 12}
        lens:
          type: line
          data_view: metrics-*
          dimension:
            field: '@timestamp'
            type: date_histogram
          breakdown:
            type: values
            field: attributes.mountpoint
            size: 10
          metrics:
            - aggregation: average
              field: metrics.system.filesystem.utilization
              label: Disk Usage
              format:
                type: percent
